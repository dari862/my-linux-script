#!/usr/bin/env bash
## Openbox autostart
## ====================
## When you login to Openbox this autostart script will be executed to set-up your environment 
## and launch any applications you want to run at startup.
## This script is executed by default shell (sh), so 'bashisms' are not supported.
##
## Note: some programs, such as 'nm-applet' are run via XDG autostart.
## To see a list of any XDG autostarted programs run:
## 	/usr/lib/x86_64-linux-gnu/openbox-xdg-autostart --list
## 	/usr/lib/i386-linux-gnu/openbox-xdg-autostart --list
##
## More information about this can be found at: http://openbox.org/wiki/Help:Autostart

#### Kill if already running  ########################################################################

for prosses2kill in xfsettingsd picom polybar dunst ksuperkey xfce4-power-manager
do
	if [[ ! -z "$(pidof $prosses2kill)" ]]; then
		killall -9 $prosses2kill
	fi
done

#### START SETTINGS  #################################################################################

# Exec first script screenlayout found
[ -d ~/.screenlayout ] && "$(ls ~/.screenlayout/*.sh | head -1)"	

# Set keyboard settings to 250ms delay and 25cps (characters per second)
xset r rate 250 25	
# Alias for: Super key (win) = Control_Left+Tab
xcape -e "Super_L=Control_L|Tab" 									
xcape -e 'Super_L=Alt_L|F1' &
xcape -e 'Super_R=Alt_L|F1' &

# Load xmodmap keys mapping
[ -f ~/.Xmodmap ] && xmodmap ~/.Xmodmap &							

# Touchpad settings
if [ -f /sys/module/battery/initstate ] || [ -d /proc/acpi/battery/BAT0 ]; then
	# Configure touchpad
	synclient VertEdgeScroll=1 HorizEdgeScroll=1 TapButton1=1 2>/dev/null	
	# Disable touchpad while typing
	syndaemon -i .5 -K -t -R -d & 											
fi

#### START APPLICATIONS ###############################################################################
# Set wallpaper
nitrogen --restore &									
xfsettingsd &
# Start compositor
exec picom --config "$HOME/.config/picom.conf" &
# Start Conky
(sleep 2; start_conky.sh) &																										
# GNOME PolicyKit authentication
/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &	

## polkit agent
if [[ ! `pidof xfce-polkit` ]]; then
	/usr/lib/xfce-polkit/xfce-polkit &
fi

if [ ! -z "$(command -v polybar)" ]
then
        if [ "$(grep ~/.config/openbox/rc.xml -e '<file>xfce4-menu.xml</file>' -e '<file>xfce4-menu-color.xml</file>')" ]
        then
			$HOME/.config/polybar/scripts/style/old.sh
        fi
	# Start polybar
        bash ~/.config/polybar/launch.sh &          
	## Launch Plank
	exec plank &
else

        if [ ! "$(grep ~/.config/openbox/rc.xml -e '<file>xfce4-menu.xml</file>' -e '<file>xfce4-menu-color.xml</file>')" ]
        then
			$HOME/.config/xfce4/styles/old.sh
        fi
	# Start xfce4-panel
        xfce4-panel &
	# Start xfce4-clipman 
        xfce4-clipman & 
	# Start volume control
	pnmixer &
	# Start network manager
	nm-applet &				
fi 

## Enable power management
~/.local/bin/my_power_manager/my_power_managers_session &

# Show Openbox welcome
~/.config/openbox/welcome &											

## Notification Daemon
exec dunst &

## Start Music Player Daemon
exec mpd &

## Thunar Daemon
exec x-file-manager --daemon &
